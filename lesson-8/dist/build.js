(()=>{"use strict";Vue.component("search",{template:'<div><input id="search" v-model="search" ><button v-on:click="searchHandler">SEARCH</button></div>',data:()=>({search:""}),methods:{searchHandler(){this.$emit("search",this.search)}}}),Vue.component("goods-item",{template:'<div :data-id="id" class="goods-item"><div class="img-item"></div><h3>{{ title }}</h3><p>{{ price }}</p></div>',props:["title","price","id"]}),Vue.component("cart",{template:'<div>\n    <button class="cart-button" @click="openCartHandler" type="button">Корзина</button>\n    <div v-if="isVisibleCart" v-on:click="removeHandler">\n      <slot></slot>\n    </div>\n  </div>',data:()=>({isVisibleCart:!1}),methods:{openCartHandler(){this.isVisibleCart=!this.isVisibleCart},removeHandler(t){this.$emit("remove",t)}}}),new Vue({el:"#app",data:{cart:[],goods:[],filtredGoods:[],search:"",isLoaded:!1},methods:{addToCartHandler(t){const e=t.target.closest(".goods-item").dataset.id,i=this.goods.find((t=>t.id==e));fetch("/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),this.cart.push(i)},removeFromCartHandler(t){const e=t.target.closest(".goods-item").dataset.id,i=this.cart.findIndex((t=>t.id==e));this.cart.splice(i,1),fetch("/cart",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})})},searchHandler(t){""===t&&(this.filtredGoods=this.goods);const e=new RegExp(t,"gi");this.filtredGoods=this.goods.filter((t=>e.test(t.title)))}},mounted(){fetch("/data").then((t=>t.json())).then((t=>{this.goods=t,this.filtredGoods=t,this.isLoaded=!0})).catch((t=>{console.log(t)})),fetch("/cart").then((t=>t.json())).then((t=>{this.cart=t})).catch((t=>{console.log(t)}))}})})();